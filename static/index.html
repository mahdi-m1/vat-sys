<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VAT Tax System v3.0.0</title>
    <link rel="stylesheet" href="/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:wght@400;600;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body>
    <div id="app">
        <!-- Login Page -->
        <div id="login-page" class="page active">
            <div class="login-container">
                <div class="login-card paper-texture">
                    <div class="login-header">
                        <i class="fas fa-file-invoice-dollar logo-icon"></i>
                        <h1>VAT Tax System</h1>
                        <p>Bahrain NBR Compliance</p>
                    </div>
                    <form id="login-form">
                        <div class="form-group">
                            <label for="username"><i class="fas fa-user"></i> Username</label>
                            <input type="text" id="username" name="username" required placeholder="Enter username">
                        </div>
                        <div class="form-group">
                            <label for="password"><i class="fas fa-lock"></i> Password</label>
                            <input type="password" id="password" name="password" required placeholder="Enter password">
                        </div>
                        <button type="submit" class="btn btn-primary btn-block">
                            <i class="fas fa-sign-in-alt"></i> Login
                        </button>
                    </form>
                    <div class="login-footer">
                        <p>Default: admin / admin123</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Application -->
        <div id="main-app" class="page">
            <!-- Sidebar -->
            <nav id="sidebar" class="paper-texture">
                <div class="sidebar-header">
                    <i class="fas fa-file-invoice-dollar"></i>
                    <span>VAT System</span>
                </div>
                <ul class="sidebar-menu">
                    <li data-page="dashboard" class="active">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Dashboard</span>
                    </li>
                    <li data-page="clients">
                        <i class="fas fa-building"></i>
                        <span>Clients</span>
                    </li>
                    <li data-page="invoices">
                        <i class="fas fa-file-invoice"></i>
                        <span>Invoices</span>
                    </li>
                    <li data-page="upload">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <span>Upload</span>
                    </li>
                    <li data-page="review">
                        <i class="fas fa-clipboard-check"></i>
                        <span>Review Queue</span>
                    </li>
                    <li data-page="reports">
                        <i class="fas fa-chart-bar"></i>
                        <span>Reports</span>
                    </li>
                    <li data-page="users" class="admin-only">
                        <i class="fas fa-users-cog"></i>
                        <span>Users</span>
                    </li>
                    <li data-page="monitoring" class="admin-only">
                        <i class="fas fa-desktop"></i>
                        <span>Monitoring</span>
                    </li>
                    <li data-page="settings" class="admin-only">
                        <i class="fas fa-cog"></i>
                        <span>Settings</span>
                    </li>
                </ul>
                <div class="sidebar-footer">
                    <div class="user-info">
                        <i class="fas fa-user-circle"></i>
                        <span id="current-user">Admin</span>
                    </div>
                    <button id="logout-btn" class="btn btn-sm">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </nav>

            <!-- Main Content -->
            <main id="main-content">
                <!-- Dashboard Page -->
                <section id="page-dashboard" class="content-page active">
                    <div class="page-header">
                        <h2><i class="fas fa-tachometer-alt"></i> Dashboard</h2>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-card paper-texture">
                            <div class="stat-icon"><i class="fas fa-building"></i></div>
                            <div class="stat-info">
                                <h3 id="stat-clients">0</h3>
                                <p>Total Clients</p>
                            </div>
                        </div>
                        <div class="stat-card paper-texture">
                            <div class="stat-icon pending"><i class="fas fa-clock"></i></div>
                            <div class="stat-info">
                                <h3 id="stat-pending">0</h3>
                                <p>Pending Invoices</p>
                            </div>
                        </div>
                        <div class="stat-card paper-texture">
                            <div class="stat-icon review"><i class="fas fa-search"></i></div>
                            <div class="stat-info">
                                <h3 id="stat-review">0</h3>
                                <p>In Review</p>
                            </div>
                        </div>
                        <div class="stat-card paper-texture">
                            <div class="stat-icon success"><i class="fas fa-check-circle"></i></div>
                            <div class="stat-info">
                                <h3 id="stat-approved">0</h3>
                                <p>Approved</p>
                            </div>
                        </div>
                    </div>
                    <div class="dashboard-grid">
                        <div class="card paper-texture">
                            <div class="card-header">
                                <h3><i class="fas fa-file-invoice"></i> Recent Invoices</h3>
                            </div>
                            <div class="card-body">
                                <table class="table" id="recent-invoices-table">
                                    <thead>
                                        <tr>
                                            <th>Invoice #</th>
                                            <th>Client</th>
                                            <th>Type</th>
                                            <th>Status</th>
                                            <th>Date</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                        <div class="card paper-texture">
                            <div class="card-header">
                                <h3><i class="fas fa-chart-bar"></i> Recent Reports</h3>
                            </div>
                            <div class="card-body">
                                <table class="table" id="recent-reports-table">
                                    <thead>
                                        <tr>
                                            <th>Report</th>
                                            <th>Client</th>
                                            <th>Period</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Clients Page -->
                <section id="page-clients" class="content-page">
                    <div class="page-header">
                        <h2><i class="fas fa-building"></i> Clients</h2>
                        <button class="btn btn-primary" onclick="showAddClientModal()">
                            <i class="fas fa-plus"></i> Add Client
                        </button>
                    </div>
                    <div class="card paper-texture">
                        <div class="card-body">
                            <table class="table" id="clients-table">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>VAT Number</th>
                                        <th>CR Number</th>
                                        <th>Invoices</th>
                                        <th>Reports</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Invoices Page -->
                <section id="page-invoices" class="content-page">
                    <div class="page-header">
                        <h2><i class="fas fa-file-invoice"></i> Invoices</h2>
                        <div class="filters">
                            <select id="filter-client" class="form-control">
                                <option value="">All Clients</option>
                            </select>
                            <select id="filter-type" class="form-control">
                                <option value="">All Types</option>
                                <option value="sales">Sales</option>
                                <option value="purchases">Purchases</option>
                            </select>
                            <select id="filter-status" class="form-control">
                                <option value="">All Status</option>
                                <option value="pending">Pending</option>
                                <option value="review">In Review</option>
                                <option value="approved">Approved</option>
                                <option value="rejected">Rejected</option>
                            </select>
                            <button class="btn btn-secondary" onclick="loadInvoices()">
                                <i class="fas fa-filter"></i> Filter
                            </button>
                        </div>
                    </div>
                    <div class="card paper-texture">
                        <div class="card-body">
                            <table class="table" id="invoices-table">
                                <thead>
                                    <tr>
                                        <th>Invoice #</th>
                                        <th>Client</th>
                                        <th>Type</th>
                                        <th>Date</th>
                                        <th>Amount</th>
                                        <th>VAT</th>
                                        <th>Confidence</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Upload Page -->
                <section id="page-upload" class="content-page">
                    <div class="page-header">
                        <h2><i class="fas fa-cloud-upload-alt"></i> Upload Invoices</h2>
                    </div>
                    <div class="upload-container">
                        <div class="card paper-texture">
                            <div class="card-header">
                                <h3><i class="fas fa-cog"></i> Upload Settings</h3>
                            </div>
                            <div class="card-body">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Client</label>
                                        <select id="upload-client" class="form-control" required>
                                            <option value="">Select Client</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Invoice Type</label>
                                        <select id="upload-type" class="form-control" required>
                                            <option value="sales">Sales</option>
                                            <option value="purchases">Purchases</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Year</label>
                                        <select id="upload-year" class="form-control">
                                            <option value="2026">2026</option>
                                            <option value="2025">2025</option>
                                            <option value="2024">2024</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Month</label>
                                        <select id="upload-month" class="form-control">
                                            <option value="1">January</option>
                                            <option value="2">February</option>
                                            <option value="3">March</option>
                                            <option value="4">April</option>
                                            <option value="5">May</option>
                                            <option value="6">June</option>
                                            <option value="7">July</option>
                                            <option value="8">August</option>
                                            <option value="9">September</option>
                                            <option value="10">October</option>
                                            <option value="11">November</option>
                                            <option value="12">December</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card paper-texture">
                            <div class="card-header">
                                <h3><i class="fas fa-file-upload"></i> Drop Zone</h3>
                            </div>
                            <div class="card-body">
                                <div id="drop-zone" class="drop-zone">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <p>Drag & Drop files here</p>
                                    <p class="small">or click to browse</p>
                                    <p class="small">Supported: PDF, JPG, PNG</p>
                                    <input type="file" id="file-input" multiple accept=".pdf,.jpg,.jpeg,.png" hidden>
                                </div>
                                <div id="upload-preview" class="upload-preview"></div>
                                <button id="upload-btn" class="btn btn-primary btn-block" disabled>
                                    <i class="fas fa-upload"></i> Upload Files
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Review Queue Page -->
                <section id="page-review" class="content-page">
                    <div class="page-header">
                        <h2><i class="fas fa-clipboard-check"></i> Review Queue</h2>
                    </div>
                    <div class="card paper-texture">
                        <div class="card-body">
                            <table class="table" id="review-table">
                                <thead>
                                    <tr>
                                        <th>Invoice #</th>
                                        <th>Client</th>
                                        <th>Type</th>
                                        <th>Counterparty</th>
                                        <th>Amount</th>
                                        <th>VAT</th>
                                        <th>Confidence</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Reports Page -->
                <section id="page-reports" class="content-page">
                    <div class="page-header">
                        <h2><i class="fas fa-chart-bar"></i> VAT Reports</h2>
                        <button class="btn btn-primary" onclick="showGenerateReportModal()">
                            <i class="fas fa-plus"></i> Generate Report
                        </button>
                    </div>
                    <div class="card paper-texture">
                        <div class="card-body">
                            <table class="table" id="reports-table">
                                <thead>
                                    <tr>
                                        <th>Report Name</th>
                                        <th>Client</th>
                                        <th>Period</th>
                                        <th>Sales VAT</th>
                                        <th>Purchases VAT</th>
                                        <th>Net VAT</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Users Page -->
                <section id="page-users" class="content-page">
                    <div class="page-header">
                        <h2><i class="fas fa-users-cog"></i> User Management</h2>
                        <button class="btn btn-primary" onclick="showAddUserModal()">
                            <i class="fas fa-user-plus"></i> Add User
                        </button>
                    </div>
                    <div class="card paper-texture">
                        <div class="card-body">
                            <table class="table" id="users-table">
                                <thead>
                                    <tr>
                                        <th>Username</th>
                                        <th>Full Name</th>
                                        <th>Email</th>
                                        <th>Role</th>
                                        <th>Last Login</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Monitoring Page -->
                <section id="page-monitoring" class="content-page">
                    <div class="page-header">
                        <h2><i class="fas fa-desktop"></i> System Monitoring</h2>
                    </div>
                    <div class="monitoring-grid">
                        <div class="card paper-texture">
                            <div class="card-header">
                                <h3><i class="fas fa-server"></i> System Resources</h3>
                            </div>
                            <div class="card-body">
                                <div class="resource-item">
                                    <span>CPU Usage</span>
                                    <div class="progress-bar">
                                        <div id="cpu-bar" class="progress" style="width: 0%"></div>
                                    </div>
                                    <span id="cpu-value">0%</span>
                                </div>
                                <div class="resource-item">
                                    <span>Memory Usage</span>
                                    <div class="progress-bar">
                                        <div id="memory-bar" class="progress" style="width: 0%"></div>
                                    </div>
                                    <span id="memory-value">0%</span>
                                </div>
                                <div class="resource-item">
                                    <span>Disk Usage</span>
                                    <div class="progress-bar">
                                        <div id="disk-bar" class="progress" style="width: 0%"></div>
                                    </div>
                                    <span id="disk-value">0%</span>
                                </div>
                            </div>
                        </div>
                        <div class="card paper-texture">
                            <div class="card-header">
                                <h3><i class="fas fa-plug"></i> Services Status</h3>
                            </div>
                            <div class="card-body">
                                <div class="service-item">
                                    <span><i class="fas fa-database"></i> Database</span>
                                    <span id="db-status" class="status-badge">Unknown</span>
                                </div>
                                <div class="service-item">
                                    <span><i class="fas fa-robot"></i> Ollama AI</span>
                                    <span id="ollama-status" class="status-badge">Unknown</span>
                                </div>
                            </div>
                        </div>
                        <div class="card paper-texture full-width">
                            <div class="card-header">
                                <h3><i class="fas fa-users"></i> Active Users</h3>
                            </div>
                            <div class="card-body">
                                <table class="table" id="active-users-table">
                                    <thead>
                                        <tr>
                                            <th>User</th>
                                            <th>Role</th>
                                            <th>Last Activity</th>
                                            <th>Actions Today</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                        <div class="card paper-texture full-width">
                            <div class="card-header">
                                <h3><i class="fas fa-chart-line"></i> User Performance (Last 7 Days)</h3>
                            </div>
                            <div class="card-body">
                                <table class="table" id="user-metrics-table">
                                    <thead>
                                        <tr>
                                            <th>User</th>
                                            <th>Invoices Uploaded</th>
                                            <th>Invoices Approved</th>
                                            <th>Reports Generated</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Settings Page -->
                <section id="page-settings" class="content-page">
                    <div class="page-header">
                        <h2><i class="fas fa-cog"></i> Settings</h2>
                    </div>
                    <div class="settings-grid">
                        <div class="card paper-texture">
                            <div class="card-header">
                                <h3><i class="fas fa-robot"></i> Ollama AI Settings</h3>
                            </div>
                            <div class="card-body">
                                <div class="form-group">
                                    <label>Ollama URL</label>
                                    <input type="text" id="setting-ollama-url" class="form-control" placeholder="http://192.168.1.225:11434">
                                </div>
                                <div class="form-group">
                                    <label>Model</label>
                                    <select id="setting-ollama-model" class="form-control">
                                        <option value="llama3.2:latest">llama3.2:latest</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Timeout (seconds)</label>
                                    <input type="number" id="setting-ollama-timeout" class="form-control" value="60">
                                </div>
                                <div class="form-row">
                                    <button class="btn btn-secondary" onclick="testOllamaConnection()">
                                        <i class="fas fa-plug"></i> Test Connection
                                    </button>
                                    <button class="btn btn-primary" onclick="saveOllamaSettings()">
                                        <i class="fas fa-save"></i> Save Settings
                                    </button>
                                </div>
                                <div id="ollama-test-result" class="test-result"></div>
                            </div>
                        </div>
                        <div class="card paper-texture">
                            <div class="card-header">
                                <h3><i class="fas fa-percentage"></i> Tax Types</h3>
                            </div>
                            <div class="card-body">
                                <table class="table" id="tax-types-table">
                                    <thead>
                                        <tr>
                                            <th>Code</th>
                                            <th>Name</th>
                                            <th>Rate</th>
                                            <th>NBR Field</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- Modals -->
    <div id="modal-overlay" class="modal-overlay">
        <div id="modal-container" class="modal-container paper-texture">
            <div class="modal-header">
                <h3 id="modal-title">Modal Title</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div id="modal-content" class="modal-content"></div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container"></div>

    <script src="/js/app.js"></script>
</body>
</html>
